<script src="https://massistant.ddns.net:3000/socket.io/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://code.responsivevoice.org/responsivevoice.js"></script>
<script>    
    // Socket variable
    var socket = io('https://massistant.ddns.net:3000');
    // Diccionario de menús
    var menus;
    // Menú seleccionado (globalMenu por defecto)
    var menuOnUse;
    // Menús visitados
    var menuHistory = [];
    // Última vez clicado
    var lastClick;
    // ¿Está en input?
    var isOnInput = false;
    // Puntero
    var pointerMenu = -1;
    // Menu items
    var menuItems;
    // Subject items
    var subjectItems;
    // Boolean inSubject navigation mode
    var navigatingSubject;
    // Subject ID assigned
    var courseId;

    /**
     * SOCKETS MODULE
     **/
    var Sockets = (function () {
        // Se ejecuta cuando el cliente pierde la conexión con el sistema
        socket.on('disconnect', (reason) => {
            setTimeout(() => {
                $(".massistant").css("background", "linear-gradient(14deg, rgba(184, 15, 15, 0.6) 0%, rgba(219, 66, 31, 0.6) 50%, rgba(232, 122, 44, 0.6) 100%)");
                if (localStorage.getItem("visibleMass"))
                    Massistant.showMessage("Se ha perdido la conexión con el servidor. Clica abajo para intentar restablecer la conexión.");
            }, 2500);
        });

        // Se ejecuta cuando el cliente se conecta de forma correcta con el sistema
        socket.on('connect', (reason) => {
            // Cambiar a color de conectado
            $(".massistant").css("background", "linear-gradient(14deg, rgba(15, 184, 173, 0.6) 0%, rgba(31, 200, 219, 0.6) 50%, rgba(44, 181, 232, 0.6) 100%)");
            $("#massistant_popup").css("visibility", "visible");
            // Solicitar menú
            socket.emit('menusRequested');
        });

        socket.on('hostInfo', (host) => {
            localStorage.setItem('host', host);
        });

        // Se ejecuta cuando el cliente se reconecta con el sistema de forma correcta
        socket.on('reconnect', (attemtNumber) => {
            $(".massistant").css("background", "linear-gradient(14deg, rgba(15, 184, 173, 0.6) 0%, rgba(31, 200, 219, 0.6) 50%, rgba(44, 181, 232, 0.6) 100%)");
            if (localStorage.getItem("visibleMass"))
                Massistant.showMessage("Se ha reestablecido la conexión correctamente.");
        });

        // Se ejecuta cuando el usuario recibe la información que había solicitado acerca de quién ha desarrollado el asistente
        socket.on('aboutReceived', (text) => {
            Massistant.showMessage(text, 20000);
        });

        // Se ejecuta cuando el cliente recibe la información acerca de los menús disponibles
        socket.on('menusReceived', (menus) => {
            // Guardamos todos los datos
            this.menus = menus;
            socket.emit('checkUserPositionRequested', window.location.href);
        });

        // Se ejecuta para comprobar en qué página se encuentra el cliente
        socket.on('checkUserPositionReceived', (object) => {
            if (window.location.pathname.includes('message')) {
                // Asignar que el menú a usar es el da las asignaturas
                menuOnUse = menus.messageMenu;
            } else if (window.location.pathname.includes('quiz/attempt.php')) {
                // Asignar que el menú a usar es el de resolución de quiz
                menuOnUse = menus.quizMenu;
            } else if (window.location.pathname.includes('quiz/view.php')) {
                if (Utils.getQueryParam('id'))
                    socket.emit("statusOfQuizRequested", Utils.getQueryParam('id'));
            } else if ((typeof object !== 'undefined' && object[1]) || window.location.pathname.includes('course/view.php') || (window.location.pathname.includes('grade/report') && Utils.getQueryParam('id'))) {
                // Asignar que el menú a usar es el da las asignaturas
                menuOnUse = menus.courseMenu;
                if (object && object[0] === 'subjectMenu' && object.length > 1)
                    courseId = object[1];
                else
                    courseId = Utils.getQueryParam('id');
            } else {
                // Asignar que el menú a usar es el global
                menuOnUse = menus.globalMenu;
            }
            // Mostrar el menú
            Massistant.showMenu(menuOnUse);
        });

        // Se ejecuta cuando el usuario recibe las asignaturas de las que está matricualdo
        socket.on('coursesReceived', (subjects) => {
            menus.userSubjects = subjects;
            if (menus.userSubjects != undefined && menus.userSubjects.length > 0) {
                // Preguntamos qué asignatura quiere visitar
                Massistant.showMessage("¿Qué asignatura quieres visitar?", 6000000);
                // Guardamos en qué menú nos encontrabamos en primer momento y en qué posición
                menuHistory.push({ position: pointerMenu, menu: menuOnUse });
                // Asignamos qué menú se muestra en estos momentos
                menuOnUse = menus.userSubjects;
                // Mostramos el menú
                Massistant.showMenu(menuOnUse);
                // Puntero a cero
                pointerMenu = 0;
                Massistant.highlightMenuItem(pointerMenu);
            } else {
                Massistant.showMessage("Parece ser que no estás matriculado de ninguna asignatura.");
            }
        });

        // Se ejecuta cuando el usuario recibe la URL de calificaciones de la asignatura a la que quiere acceder
        socket.on('gradesReceived', (gradeObjectsArray) => {
            let tts;
            if (gradeObjectsArray !== undefined && gradeObjectsArray.length > 0) {
                tts = "Estas son las calificaciones que tienes en esta asignatura: <ul>";
                gradeObjectsArray.forEach((grade) => {
                    if (grade.finalGrade !== null)
                        tts += `<li>Un <strong>${grade.finalGrade} sobre ${grade.maxGrade}</strong> en ${grade.description}. </li>`;
                    else
                        tts += `<li><strong>Sin calificación</strong> asignada en ${grade.description}. </li>`;
                });
                tts += "</ul>";
            } else {
                tts = "No hay ninguna calificación asignada para esta asignatura.";
            }
            Massistant.showMessage(tts, 60000);
        });

        // Se ejecuta cuando el cliente entra en un cuestionario y el servidor le responde el estado
        socket.on('statusOfQuizReceived', status => {
            console.log("STATUS: " + status);
            switch (status) {
                case 'NotFound':
                case 'NotEnrolled':
                default:
                    menuOnUse = menus.globalMenu;
                    break;
                case 'NotAttempted':
                    menuOnUse = menus.quizStartMenu;
                    break;
                case 'Attempted':
                    menuOnUse = menus.quizResumeMenu;
                    break;
            }
        });

        // Se ejecuta cuando el usuario recibe la información acerca de los profesores de una asignatura, que previamente ha solicitado
        socket.on('teachersInfoReceived', (teachers) => {
            if (teachers !== undefined) {
                console.log(teachers);
            } else {
                Massistant.showMessage("Parece ser que no hay información disponible acerca de los profesores en estos momentos.");
            }
        });
    })();

    /**
     * MENUS MODULE
     **/
    var Massistant = (() => {
        // Función para mostrar en forma de menú todas las opciones
        function showMenu(data) {
            if (data !== undefined) {
                var htmlRepresentation = "";
                data.forEach((value, index) => {
                    htmlRepresentation += `<div class="massistant_menu_option massistant_menu_option_${value.type}">${value.name}<\/div>`;
                });
                $("#massistant_menu_content").html(htmlRepresentation);
                $("#massistant_menu").css({ "visibility": "visible" });

                // Asignamos el valor a la "lista"
                menuItems = $("#massistant_menu div.massistant_menu_option");

                if (localStorage.getItem("visibleMass")) {
                    $('#massistant').css({ "opacity": "1", "visibility": "visible" });
                    $("#massistant_popup").css({ "display": "block" });

                    // Si fue redirigido por alguna URL del MAssistant
                    var wasRedirected = (localStorage.getItem('wasRedirected') == 'true');
                    if (wasRedirected) {
                        Utils.textToSpeech("Has sido redirigido a la página con título:" + document.title);
                        localStorage.removeItem('wasRedirected');
                    }

                    if (menuOnUse == menus.courseMenu) {
                        Utils.textToSpeech("Estás en el menú de manejo de asignaturas");
                    } else if (menuOnUse == menus.messageMenu) {
                        Utils.textToSpeech("Estás en el menú de manejo de mensajes");
                    } else if (menuOnUse == menus.globalMenu) {
                        Utils.textToSpeech("Estás en el menú global");
                    } else if (menuOnUse == menus.quizMenu) {
                        Utils.textToSpeech("Estás en el menú de resolución de cuestionarios");
                    }
                }
            } else {
                setTimeout(() => {
                    Massistant.showMenu(menuOnUse);
                }, 1000);
            }
        }

        // Muestra un mensaje con el HTML que se le asigne en "message" y que desaparece en un intervalo específicado "timeout"
        function showMessage(message, timeout) {
            Utils.textToSpeech(message);
            $("#massistant_message").css("visibility", "visible");
            $("#massistant_message_content").empty().append(`<p id="massistant_menu_msg">${message}<\/p>`);
            setTimeout(() => {
                hideMessage();
            }, timeout || 10000);
        }

        // Oculta el mensaje, se ejecuta cuando se pulsa la "x"
        function hideMessage() {
            if (responsiveVoice.isPlaying())
                responsiveVoice.cancel();
            $("#massistant_message").css("visibility", "");
            $("#massistant_message_content").empty();
        }

        function goUpInTheMenu() {
            // Asignamos valor
            if (pointerMenu != 0 && pointerMenu != -1)
                pointerMenu = (pointerMenu - 1) % menuItems.length;
            else
                pointerMenu = menuItems.length - 1;
            highlightMenuItem(pointerMenu);
            unhighlightMenuItem(pointerMenu, false);
        }

        function goDownInTheMenu() {
            // Asignamos valor
            pointerMenu = (pointerMenu + 1) % menuItems.length;
            highlightMenuItem(pointerMenu);
            unhighlightMenuItem(pointerMenu, true);

        }

        function highlightMenuItem(index) {
            Utils.textToSpeech("Opción:" + menuOnUse[index].name);
            $(menuItems[index]).css("color", "#21b8d1").css({ "font-size": "30px", "font-weight": "bold" });
        }

        function unhighlightMenuItem(index, isPressingDown) {
            if (isPressingDown) {
                if (index != -1 && index != 0) {
                    $(menuItems[index - 1]).css("color", "").css("font-size", "").css("font-weight", "");
                } else {
                    $(menuItems[menuItems.length - 1]).css("color", "").css("font-size", "").css("font-weight", "");
                }
            } else {
                if (index !== menuItems.length - 1)
                    $(menuItems[index + 1]).css("color", "").css("font-size", "").css("font-weight", "");
                else
                    $(menuItems[0]).css("color", "").css("font-size", "").css("font-weight", "");
            }
        }

        // Global menu options
        function globalGetInOptions() {
            switch (menuOnUse[pointerMenu].type) {
                case "course":
                    // Preguntamos por las asignaturas que tenemos guardadas
                    socket.emit('coursesRequested');
                    break;
                case "about":
                    socket.emit('aboutRequested');
                    break;
                default:
                    showMessage("Esta opción no está disponible en estos momentos.");
                    break;
            }
        }

        // Course menu options
        function courseGetInOptions() {
            switch (menuOnUse[pointerMenu].option) {
                case "home":
                    if (localStorage.getItem('host') !== undefined && courseId !== undefined) {
                        window.location.replace(`${localStorage.getItem('host')}/course/view.php?id=${courseId}`);
                        localStorage.setItem("wasRedirected", true);
                    }
                    break;
                case "califications":
                    socket.emit('gradesRequested', courseId);
                    break;
                case 'teachers':
                    socket.emit('teachersInfoRequested', courseId);
                    break;
                case "navigate":
                    if (window.location.pathname.includes('course/view.php')) {
                        showMessage("Para volver presiona la flecha con dirección izquierda.", 600000);
                        $("body").off('keyup');
                        $('body').on('keyup', Navigater.keyUpEventFunction);
                        Navigater.nextItem();
                    } else {
                        showMessage('No es posible realizar esta acción desde este espacio.');
                    }
                    break;
                case "global":
                    _getInGlobalMenu();
                    break;
                default:
                    showMessage("Esta opción no está disponible en estos momentos.");
                    break;
            }
        }

        //Messages menu options
        function messagesGetInOptions() {
            switch (menuOnUse[pointerMenu].option) {
                case "global":
                    _getInGlobalMenu();
                    break;
                default:
                    showMessage("Esta opción no está disponible en estos momentos.");
                    break;
            }
        }

        //Messages menu options
        function quizGetInOptions() {
            switch (menuOnUse[pointerMenu].option) {
                default:
                    showMessage("Esta opción no está disponible en estos momentos.");
                    break;
            }
        }

        function getInTheItemOption() {
            if (pointerMenu != -1) {
                // Si es una URL                
                if (menuOnUse[pointerMenu].url) {
                    window.location.replace(menuOnUse[pointerMenu].url);
                    localStorage.setItem("wasRedirected", true);
                }
                // Acciones que difieren por tipo de menú
                else {
                    // Si es el menú global
                    if (menuOnUse === menus.globalMenu) {
                        globalGetInOptions();
                    }
                    // Si es el menú de encontrar curso
                    else if (menuOnUse === menus.userSubjects) {
                        (() => { })(); // Nothing
                    }
                    // Si es el menú de dentro de un curso
                    else if (menuOnUse === menus.courseMenu) {
                        courseGetInOptions();
                    }
                    // Si es el menú de resolver un quiz
                    else if (menuOnUse === menus.quizMenu || menuOnUse === menus.quizStartMenu || menuOnUse === menus.quizResumeMenu || menuOnUse === menus.quizFinishMenu) {
                        quizGetInOptions();
                    }
                    // Si es el menú de los mensajes
                    else if (menuOnUse === menus.messageMenu) {
                        messagesGetInOptions();
                    }
                }
            }
        }

        function _getInGlobalMenu() {
            // Guardamos en qué menú nos encontrabamos en primer momento y en qué posición
            menuHistory.push({ position: pointerMenu, menu: menuOnUse });
            // Asignamos qué menú se muestra en estos momentos
            menuOnUse = menus.globalMenu;
            // Mostramos el menú
            showMenu(menuOnUse);
            // Puntero a cero
            pointerMenu = -1;
            Utils.textToSpeech("Para volver al menú anterior presiona la flecha con dirección izquierda");
        }

        function keyUpEventFunction(event) {
            if (!isOnInput && socket.connected && !socket.disconnected) {
                switch (event.keyCode) {
                    // m
                    case 77:
                        doubleClickMA();
                        break;
                    // Left
                    case 37:
                        if (localStorage.getItem("visibleMass") && menuHistory.length !== 0) {
                            // Recogemos la información del menú anterior
                            let previousMenuInfo = menuHistory.pop();
                            // Recogemos el menú
                            menuOnUse = previousMenuInfo.menu;
                            // Recogemos el puntero
                            pointerMenu = previousMenuInfo.position;
                            // Mostramos el menú y destacamos la opción en la que ha entrado previamente
                            showMenu(menuOnUse);
                            highlightMenuItem(pointerMenu);

                            // Ocultar mensaje si está mostrandose alguno
                            hideMessage();
                        }
                        break;
                    // Up
                    case 38:
                        if (localStorage.getItem("visibleMass")) {
                            event.preventDefault();
                            goUpInTheMenu();
                        }
                        break;
                    // Right
                    case 39:
                        if (localStorage.getItem("visibleMass")) {
                            event.preventDefault();
                            // Ocultar mensaje si está mostrandose alguno
                            hideMessage();
                            getInTheItemOption();
                        }
                        break;
                    // Down
                    case 40:
                        if (localStorage.getItem("visibleMass")) {
                            event.preventDefault();
                            goDownInTheMenu();
                        }
                        break;
                }
            }
        }

        function keyDownEventFunction(event) {
            console.log(event.keyCode);
            if (!isOnInput && socket.connected && !socket.disconnected) {
                switch (event.keyCode) {
                    case 37:
                    case 38:
                    case 39:
                    case 40:
                    case 77:
                        if (localStorage.getItem("visibleMass"))
                            event.preventDefault();
                        break;
                }
            }
        }

        function doubleClickMA() {
            if (!localStorage.getItem("visibleMass")) {
                localStorage.setItem("visibleMass", true);
                $('#massistant').css({ "opacity": "1", "visibility": "visible" });
                $('#massistant > div').css({ "visibility": "" });
                $('#massistant_popup').css({ "display": "block" });
                showMenu(menuOnUse);
            }
            else {
                if (responsiveVoice.isPlaying())
                    responsiveVoice.cancel();
                $('#massistant').css({ "opacity": "", "visibility": "" });
                $('#massistant_popup').css({ "display": "none" });
                localStorage.removeItem("visibleMass");
            }
        }

        // Se ejecuta cuando se realiza click en el ícono
        function onclickma() {
            // ¿Es doble click?
            let newClick = Date.now();
            if (socket.connected && !socket.disconnected && lastClick != undefined && newClick - lastClick < 200) {
                doubleClickMA();
            }
            // Forzar reconexión
            else if (socket.disconnected) {
                socket.open();
                setTimeout(() => {
                    if (socket.connected)
                        showMessage("Se ha reestablecido la conexión correctamente.");
                }, 200);
            }
            lastClick = Date.now();
        };

        return {
            showMenu, showMessage, hideMessage, highlightMenuItem, keyUpEventFunction, keyDownEventFunction, onclickma, doubleClickMA
        }
    })();

    /**
     * UTILS MODULE 
     **/
    var Utils = (() => {

        // Realiza la función de reproducir el audio
        function textToSpeech(text) {
            if (responsiveVoice.isPlaying())
                responsiveVoice.cancel();
            var regex = /(<([^>]+)>)/ig;
            textNoHTML = text.replace(regex, "");
            responsiveVoice.speak(textNoHTML, "Spanish Female");
        }

        /**
         * Función que recoge el parámetro que le indiques de la URL
         * @param {string} name
         **/
        function getQueryParam(name) {
            let paramsString = window.location.search.replace('?', '');
            // Si soporta URLSearchParams
            if (typeof URLSearchParams !== 'undefined') {
                let paramsObjectController = new URLSearchParams(paramsString);
                if (paramsObjectController.has(name))
                    return paramsObjectController.get(name);
            }
            // Retrocompatibilidad
            else {
                let paramsArray = paramsString.split('&');
                let valueReturned;
                paramsArray.forEach((param, number) => {
                    let key = param.split('=')[0];
                    let value = param.split('=')[1];
                    if (key === name) {
                        valueReturned = value;
                    }
                });
                return valueReturned;
            }
        }

        return {
            textToSpeech, getQueryParam
        }
    })();

    /**
     * NAVIGATOR MODULE
     **/
    var Navigater = (() => {
        let pointer = -1;

        function nextItem() {
            pointer = (pointer + 1) % subjectItems.length;
            if (pointer != 0)
                $(subjectItems[pointer - 1]).css("border", "").css("padding", "");
            else if (pointer == 0)
                $(subjectItems[subjectItems.length - 1]).css("border", "").css("padding", "");
            $(subjectItems[pointer]).css("border", "1px black solid").css("padding", "10px");

            let text = $(subjectItems[pointer]).children("a").text();
            Utils.textToSpeech(text);
        }

        function previousItem() {
            // Asignamos valor
            if (pointer != 0 && pointer != -1)
                pointer = (pointer - 1) % subjectItems.length;
            else
                pointer = subjectItems.length - 1;
            if (pointer == subjectItems.length - 1) {
                $(subjectItems[0]).css("border", "").css("padding", "");
                $(subjectItems[pointer]).css("border", "1px black solid").css("padding", "10px");
            } else {
                $(subjectItems[pointer + 1]).css("border", "").css("padding", "");
                $(subjectItems[pointer]).css("border", "1px black solid").css("padding", "10px");
            }

            let text = $(subjectItems[pointer]).children("a").text();
            Utils.textToSpeech(text);
        }

        function keyUpEventFunction(event) {
            if (!isOnInput && socket.connected && !socket.disconnected) {
                switch (event.keyCode) {
                    // Left
                    case 37:
                        if (localStorage.getItem("visibleMass")) {
                            $("body").off('keyup');
                            $("body").on('keyup', Massistant.keyUpEventFunction);
                            pointer = -1;
                            subjectItems.css("border", "").css("padding", "");
                            Massistant.hideMessage();
                            Utils.textToSpeech("Vuelves a estar en el menú de manejo de asignaturas");
                        }
                        break;
                    // Up
                    case 38:
                        if (localStorage.getItem("visibleMass")) {
                            previousItem();
                        }
                        break;
                    // Right
                    case 39:
                        if (localStorage.getItem("visibleMass")) {
                            window.open($(subjectItems[pointer]).children("a")[0].href);
                            Utils.textToSpeech("Has abierto una nueva pestaña, cierrala para volver a Moodle.");
                        }
                        break;
                    // Down
                    case 40:
                        if (localStorage.getItem("visibleMass")) {
                            nextItem();
                        }
                        break;
                }
            }
        }

        return {
            keyUpEventFunction, nextItem
        }
    })();

    /**
     * QUIZ RESOLVER MODULE
     **/
    var QuizResolver = (() => {
        let type = '';
        let pointer = -1;

        function nextQuestion() {
            $($("form[id='responseform']  input[type='submit']")).click();
        }

        function previousQuestion() {
            // Recoger la URL actual
            let currentPage = getQueryParam("page");
            if (typeof page !== 'undefined' && currentPage <= 0) {
                let referTo = `${window.location.origin}${window.location.pathname}?attempt = ${Utils.getQueryParam('attempt')
                    }& page=${Utils.getQueryParam('page') - 1}`;
                window.location.replace(referTo);
            }
        }

        function finishAttempt() {
            let attemptNumber = getQueryParam("attempt");
            if (typeof attemptNumber !== 'undefined') {
                let referTo = $(".endtestlink")[0].href;
                window.location.replace(referTo);
            }
        }

        function navMultiChoiceUp() {

        }

        function navMultiChoiceDown() {

        }

        function goToEssay() {

        }

        function goToTextBox() {

        }

        function keyUpEventFunction(event) {
            if (!isOnInput && socket.connected && !socket.disconnected) {
                switch (event.keyCode) {
                    // Left
                    case 37:
                        if (localStorage.getItem("visibleMass")) {
                            $("body").off('keyup');
                            $("body").on('keyup', Massistant.keyUpEventFunction);
                            pointer = -1;
                            subjectItems.css("border", "").css("padding", "");
                            Massistant.hideMessage();
                            Utils.textToSpeech("Vuelves a estar en el menú de manejo de asignaturas");
                        }
                        break;
                    // Up
                    case 38:
                        if (localStorage.getItem("visibleMass")) {
                            previousItem();
                        }
                        break;
                    // Right
                    case 39:
                        if (localStorage.getItem("visibleMass")) {
                            window.open($(subjectItems[pointer]).children("a")[0].href);
                            Utils.textToSpeech("Has abierto una nueva pestaña, cierrala para volver a Moodle.");
                        }
                        break;
                    // Down
                    case 40:
                        if (localStorage.getItem("visibleMass")) {
                            nextItem();
                        }
                        break;
                }
            }
            switch (type) {
                case 'multichoice':
                case 'truefalse':
                    break;
                case 'shortanswer':
                    break;
                case 'numerical':
                    break;
                case 'essay':
                    break;
                case 'calculatedmulti':
                    break;
                case 'calculatedsimple':
                    break;
                case 'gapselect':
                    break;
                default:
                    break;
            }
        }
    })();

    // Opciones cargadas cuando el DOM se encuentra totalmente cargado
    $('document').ready(() => {

        $('#massistant_icon').click(Massistant.onclickma);

        $('input').focusin(() => {
            isOnInput = true;
        });

        $('input').focusout(() => {
            isOnInput = false;
        });

        // Ejecutado únicamente cuando se levanta el dedo de la tecla
        $('body').keyup(Massistant.keyUpEventFunction);
        $('body').keydown(Massistant.keyDownEventFunction);

        // Guardamos todos los elementos importantes para la navegación
        subjectItems = $(".activityinstance");
    });
</script>

<style>
    p#massistant_menu_msg {
        margin: 20px 10px 0px 10px;
        text-align: center;
    }

    div.massistant {
        cursor: pointer;
        position: fixed;
        height: 70px;
        width: 70px;
        background: linear-gradient(14deg, rgba(188, 186, 186, 0.6) 0%, rgba(78, 78, 78, 0.6) 50%, rgba(218, 218, 218, 0.6) 100%) repeat scroll 0% 0%;
        margin: -115px 12px 12px 0px;
        right: 0;
        text-align: center;
        line-height: 70px;
        font-size: 30px;
        border: 0px solid transparent;
        border-radius: 100px;
        bottom: 0;
    }

    div#massistant {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        opacity: 0.3;
    }

    div#massistant:hover {
        opacity: 1;
    }

    div.massistant_popup {
        position: fixed;
        margin: auto 12px 82px 0px;
        right: 0;
        bottom: 0;
        visibility: hidden;
        display: none;
    }

    div.massistant_box {
        max-height: 450px;
        max-width: 400px;
        background: #f5f5f5;
        box-shadow: 0px 0px 10px #AAA;
        border-radius: 6px;
        visibility: hidden;
        padding: 5px;
        margin-bottom: 10px;
        margin-left: 10px;
        position: relative;
    }

    div.massistant_popupbox_close_btn {
        position: absolute;
        height: 20px;
        width: 20px;
        margin-right: 5px;
        line-height: 20px;
        text-align: center;
        font-size: 20px;
        cursor: pointer;
        font-family: calibri;
        right: 0;
    }

    .massistant_menu_option {
        text-align: left;
        margin-bottom: 20px;
        font-size: 28px;
        word-break: inherit;
        line-height: 30px;
        padding-left: 45px;
    }

    .massistant_popupbox_content {
        font-size: 20px;
        word-break: inherit;
        line-height: 25px;
        margin: 25px;
        cursor: context-menu;
    }

    .massistant_menu_option_course {
        background: url(https://image.flaticon.com/icons/svg/103/103340.svg) no-repeat;
        background-size: 30px;
    }

    .massistant_menu_option_message {
        background: url(https://image.flaticon.com/icons/svg/126/126516.svg) no-repeat;
        background-size: 30px;
    }

    .massistant_menu_option_clasification {
        background: url(https://image.flaticon.com/icons/svg/782/782702.svg) no-repeat;
        background-size: 30px;
    }

    .massistant_menu_option_about {
        background: url(https://image.flaticon.com/icons/svg/685/685815.svg) no-repeat;
        background-size: 30px;
    }

    .massistant_menu_option_menu_toggle {
        background: url(https://image.flaticon.com/icons/svg/109/109682.svg) no-repeat;
        background-size: 30px;
    }

    .massistant_menu_option_config {
        background: url(https://image.flaticon.com/icons/svg/70/70367.svg) no-repeat;
        background-size: 30px;
    }

    .massistant_menu_option_home {
        background: url(https://image.flaticon.com/icons/svg/263/263115.svg) no-repeat;
        background-size: 30px;
    }

    .massistant_menu_option_undefined {
        background: url(https://image.flaticon.com/icons/svg/90/90492.svg) no-repeat;
        background-size: 30px;
    }

    @media screen and (max-height: 759px) and (min-width: 600px) {
        div.massistant_box {
            display: inline-block;
        }
    }

    @media screen and (max-width: 600px) {
        div#massistant {
            display: none;
        }
    }
</style>